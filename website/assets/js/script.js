!function(e){if("function"==typeof bootstrap)bootstrap("ng-time-relative",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeNgTimeRelative=e}else"undefined"!=typeof window?window.ngTimeRelative=e():global.ngTimeRelative=e()}(function(){return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o="function"==typeof require&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0](function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){"use strict";function directive($timeout,moment){return{restrict:"AC",scope:{datetime:"@"},link:function(scope,element,attrs){var timeout;scope.$watch("datetime",function(dateString){function updateTime(){element.text(diffString(date,to()))}function diffString(a,b){return Math.abs(a.clone().startOf("day").diff(b,"days",!0))<1?a.from(b,withoutSuffix):a.calendar(b)}function updateLater(){updateTime(),timeout=$timeout(function(){updateLater()},nextUpdateIn())}function nextUpdateIn(){var delta=Math.abs(moment().diff(date));return 45e3>delta?45e3-delta:9e4>delta?9e4-delta:27e5>delta?6e4-(delta+3e4)%6e4:366e4-delta%36e5}$timeout.cancel(timeout);var date=moment(dateString);if(date){var to=function(){return moment(attrs.to)},withoutSuffix="withoutSuffix"in attrs;attrs.title||element.attr("title",date.format("LLLL")),element.bind("$destroy",function(){$timeout.cancel(timeout)}),updateLater()}})}}}if(exports=module.exports=function(module){module.constant("timeRelativeConfig",{calendar:{en:{lastDay:"[Yesterday], LT",sameDay:"[Today], LT",nextDay:"[Tomorrow], LT",lastWeek:"dddd, LT",nextWeek:"[Next] dddd, LT",sameElse:"LL"}}}).directive("relative",["$timeout","moment",directive]).run(["moment","timeRelativeConfig",function(moment,timeRelativeConfig){angular.forEach(timeRelativeConfig.calendar,function(translation,lang){moment.lang(lang,{calendar:translation})})}])},exports.directive=directive,angular){var mod=angular.module("timeRelative",[]);moment&&(mod.constant("moment",moment),moment.lang("en",{})),exports(mod)}},{}]},{},[1])}),angular.module("btford.socket-io",[]).provider("socketFactory",function(){"use strict";var defaultPrefix="socket:";this.$get=["$rootScope","$timeout",function($rootScope,$timeout){var asyncAngularify=function(socket,callback){return callback?function(){var args=arguments;$timeout(function(){callback.apply(socket,args)},0)}:angular.noop};return function(options){options=options||{};var socket=options.ioSocket||io.connect(),prefix=options.prefix||defaultPrefix,defaultScope=options.scope||$rootScope,addListener=function(eventName,callback){socket.on(eventName,callback.__ng=asyncAngularify(socket,callback))},addOnceListener=function(eventName,callback){socket.once(eventName,callback.__ng=asyncAngularify(socket,callback))},wrappedSocket={on:addListener,addListener:addListener,once:addOnceListener,emit:function(eventName,data,callback){var lastIndex=arguments.length-1,callback=arguments[lastIndex];return"function"==typeof callback&&(callback=asyncAngularify(socket,callback),arguments[lastIndex]=callback),socket.emit.apply(socket,arguments)},removeListener:function(ev,fn){return fn&&fn.__ng&&(arguments[1]=fn.__ng),socket.removeListener.apply(socket,arguments)},removeAllListeners:function(){return socket.removeAllListeners.apply(socket,arguments)},disconnect:function(close){return socket.disconnect(close)},forward:function(events,scope){events instanceof Array==!1&&(events=[events]),scope||(scope=defaultScope),events.forEach(function(eventName){var prefixedEvent=prefix+eventName,forwardBroadcast=asyncAngularify(socket,function(data){scope.$broadcast(prefixedEvent,data)});scope.$on("$destroy",function(){socket.removeListener(eventName,forwardBroadcast)}),socket.on(eventName,forwardBroadcast)})}};return wrappedSocket}}]});var electiondeskStream=angular.module("electiondeskStream",["btford.socket-io","timeRelative"]).factory("socket",function(socketFactory){return socketFactory({ioSocket:io.connect("http://electiondesk.local:4242")})}).controller("StreamController",function($scope,socket){socket.forward(["update","hello"],$scope),$scope.sourceQuery={facebook:!0,twitter:!0,googleplus:!0,wordpress:!0,disqus:!0},$scope.interactions=[],$scope.$on("socket:update",function(ev,data){var json=JSON.parse(data);console.log(json);var unixTime=(new Date).getTime()/1e3;json.interaction.created_at.sec>unixTime&&(json.interaction.created_at.sec=unixTime),$scope.interactions.push(json)}),$scope.$on("socket:hello",function(){socket.emit("dump")})}).filter("sourcefilter",function(){return function(items,sources){if(!sources)return items;var activeSources=[];return angular.forEach(sources,function(active,source){active&&activeSources.push(source)}),items.filter(function(element){return-1!=activeSources.indexOf(element.interaction.type)})}}).filter("orderByCreated",function(){return function(items,reverse){var filtered=[];return angular.forEach(items,function(item){filtered.push(item)}),filtered.sort(function(a,b){return a.interaction.created_at.sec<b.interaction.created_at.sec?1:-1}),reverse&&filtered.reverse(),filtered}});